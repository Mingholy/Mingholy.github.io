
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>A Cup of Coffee</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Mingholy">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="A Cup of Coffee">
<meta property="og:url" content="http://ming-holy.space/page/5/index.html">
<meta property="og:site_name" content="A Cup of Coffee">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="A Cup of Coffee">

    
    <link rel="alternative" href="/atom.xml" title="A Cup of Coffee" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="A Cup of Coffee" title="A Cup of Coffee"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="A Cup of Coffee">A Cup of Coffee</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:ming-holy.space">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/15/编写可维护的JavaScript-第二部分-II/" title="编写可维护的JavaScript-第二部分-II" itemprop="url">编写可维护的JavaScript-第二部分-II</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-03-15T09:35:47.000Z" itemprop="datePublished"> 发表于 2016-03-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>这一部分的主题是编程实践。主要的内容包括：</p>
<ul>
<li>事件处理：同样是传递参数与应用逻辑的解耦</li>
<li>避免“空比较”：即判定某一变量/对象是否是空，这里要分清各个对象的类型，不能混用</li>
</ul>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/15/编写可维护的JavaScript-第二部分-II/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/15/编写可维护的JavaScript-第二部分-II/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/03/15/编写可维护的JavaScript-第二部分-II/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/07/编写可维护的JavaScript-第二部分-I/" title="编写可维护的JavaScript:第二部分-I" itemprop="url">编写可维护的JavaScript:第二部分-I</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-03-07T12:50:24.000Z" itemprop="datePublished"> 发表于 2016-03-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>这一部分的主题是编程实践。主要的内容包括：</p>
<ul>
<li>UI的松耦合：即JavaScript、CSS和HTML三者之间的解耦</li>
<li>避免使用全局变量：创建全局变量可能引起的问题和避免方式</li>
</ul>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/07/编写可维护的JavaScript-第二部分-I/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/07/编写可维护的JavaScript-第二部分-I/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/03/07/编写可维护的JavaScript-第二部分-I/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/07/SSH免密码部署-git-bash配置/" title="SSH免密码部署:git-bash配置" itemprop="url">SSH免密码部署:git-bash配置</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-03-07T11:10:29.000Z" itemprop="datePublished"> 发表于 2016-03-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在使用<code>hexo d</code>部署这个博客的时候，经常会遇到拒绝public key的问题，要求确认访问repository的权限或者确定repository存在。<br>而实际上按照github的说明我已经生成并添加了ssh key，并且使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -T git@github.com</div></pre></td></tr></table></figure></p>
<p>测试成功。<br>但是由于ssh-agent是一个临时进程，它存储公钥的方式也是写入一个临时的session，因此每次重启git-bash都会重置连接，于是每次都需要<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">eval &quot;$(ssh-agent -s)&quot;</div><div class="line">ssh-add ~/.ssh/id_rsa</div><div class="line">ssh-add -l</div></pre></td></tr></table></figure></p>
<p>走一遍才能正确部署。<br>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/07/SSH免密码部署-git-bash配置/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/SSH/">SSH</a>►<a class="article-category-link" href="/categories/SSH/Git/">Git</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/git/">git</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/07/SSH免密码部署-git-bash配置/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/03/07/SSH免密码部署-git-bash配置/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/03/07/编写可维护的JavaScript-第一部分/" title="编写可维护的JavaScript:第一部分" itemprop="url">编写可维护的JavaScript:第一部分</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-03-07T11:03:54.000Z" itemprop="datePublished"> 发表于 2016-03-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="基本格式化"><a href="#基本格式化" class="headerlink" title="基本格式化"></a>基本格式化</h2><h3 id="缩进"><a href="#缩进" class="headerlink" title="缩进"></a>缩进</h3><p>4空格为一个缩进单位。</p>
<h3 id="语句结尾"><a href="#语句结尾" class="headerlink" title="语句结尾"></a>语句结尾</h3><p>自动分号插入机制 ASI 会在大多数应该加分号的地方加分号但是这种自动机制可能会引起某些意外的错误。因此还是<strong>手动加分号</strong>，也不要省略分号。</p>
<h3 id="行的长度"><a href="#行的长度" class="headerlink" title="行的长度"></a>行的长度</h3><p>一般是80个字符的限制。  </p>
<h3 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h3><p>需要拆行的时候，在运算符后拆行，并且在拆行之后设置两个缩进。<br>如果是if语句这种，比如在判断条件语句拆行，它之后的执行主体只设置一个缩进。  </p>
<blockquote>
<p>例外:变量赋值时，第二行的位置应该和赋值运算符的位置保持对齐。  </p>
</blockquote>
        
        
        <p class="article-more-link">
          
            <a href="/2016/03/07/编写可维护的JavaScript-第一部分/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/03/07/编写可维护的JavaScript-第一部分/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/03/07/编写可维护的JavaScript-第一部分/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/15/证明-sqrt-2-是无理数/" title="证明根号2是无理数" itemprop="url">证明根号2是无理数</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-01-15T14:53:40.000Z" itemprop="datePublished"> 发表于 2016-01-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>设$\sqrt{2}$是有理数，则可表示成$\frac{n}{m}$，$m,n$均为有理数且互质。<br>于是$ n=\sqrt{2}m\Rightarrow n^2=2m^2 $，于是$n^2$为偶数，它又是个有理数，那么必有<br>$ n^2=(2n_1)^2=4n_{1}^{2} $。于是$ n^2=m^2=4n_{1}^{2} $，则有$ m^2=2n_{1}^{2} $，同理可知$m$也是偶数。<br>那么$m,n$必有公约数2，这与它们互质矛盾。<br>这样就证明了$\sqrt{2}$是无理数。</p>
<p>$\sqrt{3}$也类似。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数学/">数学</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/上帝之语/">上帝之语</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/15/证明-sqrt-2-是无理数/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/01/15/证明-sqrt-2-是无理数/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/07/贪心算法证真/" title="贪心算法证真" itemprop="url">贪心算法证真</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-01-07T13:55:03.000Z" itemprop="datePublished"> 发表于 2016-01-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<h3 id="笔者按："><a href="#笔者按：" class="headerlink" title="笔者按："></a>笔者按：</h3><p>图论的高随祥老师说：一个命题，证伪容易，找出反例就好了。证真可不容易，你得保证它不存在错误的情况。<br>眭跃飞老师也提到：数学里，恒等是一件很麻烦的事情。<br>所以曾经多次被教导，说数学里的精华都在定理上，它们是人的逻辑思维与自然的事实规律最精密最完整的体现。为了确定它们的正确性，无数人付出了不可估量的努力。<br>因此这里依照我的兴趣，记录了一些碰到的简单有趣的命题的证真思路，仅供玩味。只有从小的地方发现它的精美绝妙之处，才能从大的地方发现数学之美。</p>
</blockquote>
<hr>
        
        
        <p class="article-more-link">
          
            <a href="/2016/01/07/贪心算法证真/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数学/">数学</a>►<a class="article-category-link" href="/categories/数学/算法/">算法</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/上帝之语/">上帝之语</a><a href="/tags/算法/">算法</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/07/贪心算法证真/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/01/07/贪心算法证真/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/01/01/hello-world/" title="Hello World" itemprop="url">Hello World</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2016-01-01T12:00:00.000Z" itemprop="datePublished"> 发表于 2016-01-01</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
            <a href="/2016/01/01/hello-world/#more">Read More</a>
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/01/01/hello-world/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/01/01/hello-world/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/18/Linux Kernel-11-18/" title="Linux内核 11-18" itemprop="url">Linux内核 11-18</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2015-11-18T12:30:00.000Z" itemprop="datePublished"> 发表于 2015-11-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="最后一节课"><a href="#最后一节课" class="headerlink" title="最后一节课"></a>最后一节课</h2><p><strong>清空页表页目录表的目的</strong></p>
<ul>
<li>与父进程脱离关系</li>
<li>准备形成缺页中断，引导进程加载（P位为0，引发缺页中断。）</li>
</ul>
<p>除了寄存器页表页目录表其他都是线性地址。<br><code>trap_init</code>引导缺页中断。<br>汇编<code>_page_fault</code>中<code>_do_no_page</code>调用缺页处理函数。<br><code>_do_wp_page</code>调用写保护处理函数。</p>
<blockquote>
<p>内核操作-共享资源-写保护只读处理。这里的只读操作只针对该页。在页表项中<code>rw</code>项置0。共享进程对父进程只读，子进程同样只读。如果需要写操作，不论哪个进程先发起写请求，首先<code>get_free_page</code>复制该页到新页，当写保护结束将这个页分配给另外一个进程。写实复制都以页为单位。<br>注意，页共享是父子进程都有页，缺页中断是没有页了。共享导致页写保护。加载进程导致缺页中断。</p>
</blockquote>
<p><code>do_no_page</code></p>
<ol>
<li>首先确认缺页中断是加载进程引起的。</li>
<li>接着确认是否可以通过共享获得页。</li>
<li><code>for</code>循环连读4个块。<code>block+1</code>让出文件头。</li>
<li><code>bread_page</code>是读一个页到缓冲区，占用4个块。读盘动作总要先申请缓冲区。</li>
<li>一次从文件上读取一个页大小。</li>
<li>缓冲区操作建立：<code>bh``request</code></li>
</ol>
<blockquote>
<p>加载进程-缺页<code>page_fault</code>引发硬件中断-进入内核态处理页<code>do_no_page</code>-中断返回加载进程的用户态。<br>如果页不够用，就继续缺页中断。<br>缺页-加载-运行 循环。</p>
</blockquote>
<p>问题：<code>_do_wp_page</code>中断怎么引发的？</p>
<blockquote>
<p>在<code>share_page</code>的<code>try_to_share</code>中，<code>if(phys_addr &amp; 0x41) != 0x01</code>。即置<code>P</code>和<code>Δ</code>为1。</p>
</blockquote>
<h2 id="进程退出"><a href="#进程退出" class="headerlink" title="进程退出"></a>进程退出</h2><p>最先启动退出的是进程自身。</p>
<p><code>_exit</code><br>链接器在应用程序上加上<code>_exit</code>。直接贴机器码。<br>通过<code>int80</code>到<code>sys_call</code>走系统中断那一套。<br><code>do_exit</code><br>执行各种内存释放操作。进程不能由进程本身创建。同样退出也不能由自己退出。需要由父进程来操作。此处只是发出请求，完成自身能够执行的任务：释放内存，清空进程槽，清空文件访问关系。等等。最后将进程的状态改为<code>TASK_ZOBIE</code>，<code>僵死状态</code>。<br><strong>注意现在还在int80状态下，而此时一般的<code>iret</code>已经无进程可以返回，所以只能<code>tell_father</code></strong>。<br>这就涉及进程间通讯。(参见第八章)</p>
<blockquote>
<p>考虑到进程之间有非常明确的边界，如何实现这种需求？</p>
<ul>
<li>管道。<br>思路：进程都可以读写盘。但是盘读写速度太慢。改用内存。使用文件的形式，存在内存里。发信进程存盘，收信进程读盘。在内存的虚拟盘中，由通讯双方独享的一个小缓冲区。</li>
<li>信号。<br>思路：退出进程遗留部分需要父进程处理。一个父进程可以有多个子进程。如何得到进程退出的信息？轮询？中断？<br>实际：仿中断。软中断。所有的进程都有<code>int80</code>，就利用这个。</li>
</ul>
</blockquote>
<p><code>tell_father</code>向父进程发送子进程退出信号。只要父进程使用<code>int80</code>就将接收到信号。<br>发送信号之后调用<code>schedule</code>。<br>一旦调度到父进程，<code>schedule</code>肯定不是第一次运行，一定从中间(<code>ljmp</code>下一行)运行回到<code>ret_from_sys_call</code>，这其中就有一个信号处理函数<code>_do_signal</code>。随后清栈，<code>iret</code>后回到<code>int80</code>下一行。如果没有<code>_do_signal</code>父进程将回到用户态继续运行。而现在由于它的存在，进程就指向了<code>wait</code>。由它引发<code>sys_waitpid</code>(<strong>书上419页，<code>_do_signal</code></strong>)。此间内核态到用户态如何转换？软中断<code>int80</code>时，保存现场压栈，栈是内核栈，内容是用户态时调用<code>int80</code>的下一行。也就是说内核栈弹出的内容将是用户态。现在就将内核栈上保存的内容，复制到用户栈上。然后修改内核栈，使进程转向父进程的<code>wait</code>，再<code>int80</code>执行<code>sys_waitpid</code>开始清理。清理结束之后就要根据用户栈内容到回到父进程的用户态。至此子进程退出彻底完成。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/操作系统/">操作系统</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/11/18/Linux Kernel-11-18/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/11/18/Linux Kernel-11-18/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/16/Linux Kernel-11-16/" title="Linux内核 11-16" itemprop="url">Linux内核 11-16</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2015-11-16T12:30:00.000Z" itemprop="datePublished"> 发表于 2015-11-16</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="进程的加载与退出"><a href="#进程的加载与退出" class="headerlink" title="进程的加载与退出"></a>进程的加载与退出</h2><p><code>云里雾里</code></p>
<p><code>do_execve</code></p>
<p><code>文件头</code>：通过文件头确定文件类型。首先将文件头读取缓冲区，在缓冲区确认这个信息。</p>
<p>现在我们要加载一个可执行文件。加载它就需要创建进程。父进程创建子进程之后，要么共享父进程的资源，包括代码，要么加载自身的代码。</p>
<p>linux要求代码需要是只读的。防止被随意篡改。</p>
<p>代码很短的时候，到不了一个页，应该怎么装？</p>
<p>正是因为代码需要只读，而数据则是频繁变化的，因此它们一定要分头加载，装入两个不同的页中。<br>而这一“分头的”的操作并没有体现在代码上，原因在于<code>ZMAGIC</code>，魔数。</p>
<blockquote>
<p>内核在必要时从二进制文件中加载独立的页面，执行头部，代码段和数据段都被链接程序处理成多个页面大小的块。内核加载的代码页是只读的，数据段的页面是可写的。</p>
</blockquote>
<p>随后进行检验，拷贝环境变量。</p>
<p>一个文件具有inode，它的路径有另一个文件的内容指向，而它本身的inode又有另一个文件指向。最终最后一个就是根inode.</p>
<blockquote>
<p>内存中的inode内容要比硬盘中的inode内容多一点。</p>
</blockquote>
<p>根据之前读到的文件头与进程关联。注意，此时并没有加载。</p>
<p>加载之前首先要与父进程脱离关系。<br>首先就是清理。</p>
<p>由当前进程脱钩。</p>
<p><code>free_page_tables</code><br>清空页表项和页目录表，为何以ldt为标准？<br>因为结构都是线性的，按照线性吵结构清空即可。<br>要想脱离父进程，就把它的那份与父进程共享的代码和数据清空。</p>
<blockquote>
<p>注意：这里仅仅是把它的这份放掉，父进程自己还有一份，不受影响。</p>
</blockquote>
<p>接下来又要修改ldt。为什么要改它？<br>父子进程共享，线性并没有共享。<br><code>copy_process</code>之后的的<code>copy_mem</code>其中的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">new_data_base = new_code_base - nr* 0x4000000</div></pre></td></tr></table></figure></p>
<p>其中<code>nr</code>来自于<code>copy_process</code>，<code>find_empty_process</code>遍历<code>task</code>数组之后返回<code>nr</code>，父子进程<code>nr</code>不同，线性地址空间也不同。</p>
<blockquote>
<p>父子进程共享的时候，把限长也共享了。虽然每页有64MB，但并不需要把它全占满。原则：够用即可。卡到8MB，多了也不给。</p>
</blockquote>
<p>新的操作系统，一个进程占满4G线性地址空间，并且内核与用户共用。<br>特权级问题：代码能随便跳特权级吗？</p>
<blockquote>
<p>只考虑段，可以。特权级落实到内存上但是在CPU上动手。实际上是CPU寻址权限控制/访问权限控制。执行谁的代码就是谁的特权级。<br>实际上还是可以阻止这种做法。<code>分界。</code>内存分页的时候，卡到某一位置剩下的就不分配了，即使有线性地址也不能访问。无论是内核和用户，都要经过内存分页。<br>将用户段与内核段线性排列而非重合，可以吗？不可以。因为系统代码使得内核线性地址空间就16MB，也就是当时linus的机器的物理内存。内核的线性地址宽度至少要覆盖物理内存。必须要覆盖全部内存，为了获得最大寻址。用来管理内存分页。否则没有分页的内存不能用。</p>
<p>段间跳转仅限于同特权级。内核不是通过线性地址来管理内存的，并不需要通过段间跳转来管理。但它仍然可以通过内存分页管理，直接动页物理地址。这时段的作用被淡化，内核线性地址顶两头。</p>
</blockquote>
<p><code>change_idt</code><br>父进程的线性地址，与子进程的线性地址并不共享。创建进程时<code>nr* 0x4000000</code>已经给了不同的基址，不变的就是限长。<br>证据：</p>
<ul>
<li><code>copy_mem</code>只设置了段基址，根本没有动限长。</li>
<li>在它之前的<code>copy_process</code>也只是拷贝了ldt tss，其中限长直接继承了，而且没有改动过。</li>
<li><code>copy_page_tables</code>接受的<code>data_page_limit</code>也是由<code>get_limit</code>获得的父进程的限长，没有更改过。</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/操作系统/">操作系统</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/11/16/Linux Kernel-11-16/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/11/16/Linux Kernel-11-16/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/11/Linux Kernel-11-11/" title="Linux内核 11-11" itemprop="url">Linux内核 11-11</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Mingholy" target="_blank" itemprop="author">Mingholy</a>
		
  <p class="article-time">
    <time datetime="2015-11-11T09:00:00.000Z" itemprop="datePublished"> 发表于 2015-11-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><code>光棍节快乐</code></p>
<h2 id="缓冲区"><a href="#缓冲区" class="headerlink" title="缓冲区"></a>缓冲区</h2><p>为了防止意外刺激引发读入垃圾数据，需要使用uptodate缓冲块，从块读出后，更新uptodate位。</p>
<p>同一缓冲块被多个进程共享，若某一时刻，一个缓冲块已由一个进程挂起，此时若新来一个进程，它并不知道自己是不是第一次读。此时需要判断bufferhead中的uptodate。</p>
<p>写的情形：如果是第一次申请写一个块，需要不需要确认uptodate？</p>
<ul>
<li>假设该块是一个新文件，它对应的硬盘块也是垃圾数据。操作系统已经明确该文件是新的，新建i节点，并且是写操作，此时不需要确认uptodate位，因为新建操作就是用垃圾数据覆盖垃圾数据（内存中实际上是被清零了的。）当进程–缓冲区-硬盘块建立联系之后，立即置uptodate为1。</li>
<li>假设该缓冲块不是第一次写，而且可能也写不满一个缓冲块。那么就有一种情况，是后来的进程没有写满而该缓冲块还带着以前进程的数据，就产生了错误。</li>
</ul>
<p><strong>uptodate:保护数据正确性。</strong></p>
<blockquote>
<p>当一个进程写完了一个块，另一个进程马上又更改了这个块，何如？<br>重点：两个进程必须是共享该缓冲块。操作系统认定两个进程一定是对这个块具有同等的操作权限的。</p>
<p>首先最重要的是设备号块号，缓冲区的核心是“复用”。一个使缓冲区失去意义的应用场景是，不存在复用</p>
</blockquote>
<p>补充：</p>
<ul>
<li>进程0第一次切换进程1，从0特权级切到3特权级。当时进程0是可中断等待状态，进程1是运行态。通过任务切换方式切换。为什么能够判断是切到3特权级？因为所有的关于段的信息，都写在tss里，它里面存储的就是恢复现场时寄存器里应该有的<strong>关于段的</strong>数据。而特权级是基于段的，所以tss信息确定了之后，特权级也就确定了。</li>
<li>第二次是读引导块，进程0是可中断挂起状态，进程1是不可中断挂起。c=-1屏蔽了while中修改c和next的操作，使得switch_to参数强行是0，即切换到进程0，特殊之处在于此时<em>并没有运行态的进程</em>。</li>
<li>第三次是进程0，切换到0。进程1是不可中断等待状态，因为它正在等待读盘，读完盘中断才能切回来恢复。switch_to中比较发现要切换的目标进程正式进程0本身。于是直接跳过中间好几行代码。直接到“1：”。</li>
</ul>
<h2 id="进程的加载与退出"><a href="#进程的加载与退出" class="headerlink" title="进程的加载与退出"></a>进程的加载与退出</h2><p>创建进程， 重要的东西是task_struct<br>fork=&gt;copy_proc</p>
<blockquote>
<p>进程0创建进程1以后代码自动就填充了。move_to_user_mode就地翻身，它的代码是写在内核中的，是系统程序员设计好的。</p>
</blockquote>
<p>一般的用户进程，开始执行后，首先就去fork来一套，创建进程框架。<br>某个用户进程，一定是由某个父进程创建的。linux为例，用户执行某一程序就是由shell创建的。windows gui只是封装了这一操作。（暂时这么理解。）</p>
<blockquote>
<p>创建进程之后，该父进程还要加载它。fork的时候还是3特权级，fork之后去往int80走系统调用进入内核态执行0特权级代码，中断回来之后又回到3特权级。<br>而子进程可以全程执行父进程的代码，它们可以一直共享资源。</p>
</blockquote>
<p><code>_syscall3</code>走3特权级</p>
<p>根据文件系统分配代码和数据的的位置。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Linux/">Linux</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Linux/">Linux</a><a href="/tags/操作系统/">操作系统</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/11/11/Linux Kernel-11-11/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/11/11/Linux Kernel-11-11/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/4/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/C/" title="C++">C++<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Dubtitler/" title="Dubtitler">Dubtitler<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/ES6/" title="ES6">ES6<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/ES6/" title="ES6">ES6<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/SSH/Git/" title="Git">Git<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/Hadoop/HBase/" title="HBase">HBase<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/Hadoop/" title="Hadoop">Hadoop<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/IFE2017/" title="IFE2017">IFE2017<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>20</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/Notes/" title="Notes">Notes<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/SSH/" title="SSH">SSH<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/人民南路四段九号/" title="人民南路四段九号">人民南路四段九号<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端安全/" title="前端安全">前端安全<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/数学/" title="数学">数学<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/数学/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/网络/" title="网络">网络<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">五月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/04/">四月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">三月 2016</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">一月 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/11/">十一月 2015</a><span class="archive-list-count">7</span></li></ul>
  </div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>22</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>10</sup></a></li>
			
		
			
				<li><a href="/tags/操作系统/" title="操作系统">操作系统<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/CSS/" title="CSS">CSS<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/HTML/" title="HTML">HTML<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ES6/" title="ES6">ES6<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/编辑器/" title="编辑器">编辑器<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Java/" title="Java">Java<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Hadoop/" title="Hadoop">Hadoop<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/上帝之语/" title="上帝之语">上帝之语<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/网络/" title="网络">网络<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/异步编程/" title="异步编程">异步编程<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/git/" title="git">git<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/前端安全/" title="前端安全">前端安全<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/DOM/" title="DOM">DOM<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C++">C++<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Graph-Compute/" title="Graph Compute">Graph Compute<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/跨域/" title="跨域">跨域<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/DubtitlerDev/" title="DubtitlerDev">DubtitlerDev<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Be a live-wire artist, <br/>
			Do something amazing.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/mingholy" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
		<a href="mailto:liminghao15@mails.ucas.ac.cn" target="_blank" class="icon-email" title="Email Me"></a>
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2017 
		
		<a href="/about" target="_blank" title="Mingholy">Mingholy</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>










<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<script src="https://s4.cnzz.com/z_stat.php?id=1261294969&web_id=1261294969" language="JavaScript"></script>

<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
